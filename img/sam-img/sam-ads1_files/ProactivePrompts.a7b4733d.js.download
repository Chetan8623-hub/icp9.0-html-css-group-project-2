((self||this)["webpackJsonp@sprinklrjs/chat-web-client"]=(self||this)["webpackJsonp@sprinklrjs/chat-web-client"]||[]).push([[55],{1085:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(191),c=r.n(n);var a=class{constructor(){this._map=void 0,this._map={}}addEntry(e){this._map[e]||(this._map[e]={subscribers:[],variants:[]})}setAction(e,t){const r=(e=>{const t=e.indexOf("_");return-1!==t?e.substring(0,t):e})(e),n=Date.now();this.addEntry(r),this._map[r].variants=[...this._map[r].variants,{actionState:t,actionTime:n,id:e}],this._map[r].subscribers.forEach((e=>{e(t)})),this._map[r].subscribers=[]}setSubscriber(e,t){return this.addEntry(e),this._map[e].subscribers.push(t),()=>{this._map[e].subscribers=this._map[e].subscribers.filter((e=>e!==t))}}getActionState(e,t){const r=this._map[e]&&this._map[e].variants;if(r&&r.length){const e=r.find((e=>e.id===t));return t?e&&e.actionState:r[r.length-1].actionState}}getActionDetails(){return this._map}},s=r(192);const i=c.a.createContext(void 0);t.b=e=>{let{children:t}=e;const r=Object(n.useRef)(new a);return Object(s.jsx)(i.Provider,{value:r.current},t)}},1399:function(e,t,r){var n=r(88),c=r(593),a=r(679),s=r(56),i=r(57),u=r(89),o=Math.min;e.exports=function(e,t,r){for(var l=r?a:c,b=e[0].length,d=e.length,O=d,E=Array(d),T=1/0,v=[];O--;){var _=e[O];O&&t&&(_=s(_,i(t))),T=o(_.length,T),E[O]=!r&&(t||b>=120&&_.length>=120)?new n(O&&_):void 0}_=e[0];var j=-1,I=E[0];e:for(;++j<b&&v.length<T;){var h=_[j],g=t?t(h):h;if(h=r||0!==h?h:0,!(I?u(I,g):l(v,g,r))){for(O=d;--O;){var f=E[O];if(!(f?u(f,g):l(e[O],g,r)))continue e}I&&I.push(g),v.push(h)}}return v}},1400:function(e,t,r){var n=r(93);e.exports=function(e){return n(e)?e:[]}},1525:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return Qt}));var n=r(191),c=r.n(n),a=r(288),s=r.n(a),i=r(192),u=r(31),o=r.n(u),l=r(266),b=r.n(l),d=r(354),O=r.n(d),E=r(286),T=r.n(E),v=r(48),_=r.n(v),j=r(255),I=r(856),h=r(496),g=r(472),f=r(50),p=r(298);const C="IDLE",m="TRACKING";var S=()=>{const{subscribe:e}=Object(g.a)(),t=Object(n.useCallback)((()=>({eventType:p.a.PAGE_VISIT,eventId:c.current,details:{title:Object(f.c)(),oldUrl:c.current,newUrl:a.current}})),[]),r=Object(I.useFirstMountState)(),c=Object(n.useRef)(""),a=Object(n.useRef)(Object(f.b)()),{loading:s,refetch:i}=Object(h.a)({payload:t(),skipQueryOnMount:!1});return Object(n.useEffect)((()=>{const r=e("pageVisitTrackerInPrompt",(e=>{let{currentUrl:r,previousUrl:n}=e;c.current=n,a.current=r,i(t())}));return()=>{r&&r()}}),[i]),{trackingStatus:r||s?m:C}},R=r(9);var y=()=>{const{refetch:e}=Object(h.a)({skipQueryOnMount:!0});Object(n.useEffect)((()=>{const t=()=>{e({eventType:p.a.TAB_CHANGE,eventId:Object(f.b)(),details:{isActive:Object(R.d)()}})};return document.addEventListener("visibilitychange",t),()=>{document.removeEventListener("visibilitychange",t)}}),[e])};var N=()=>{const{refetch:e}=Object(h.a)({skipQueryOnMount:!0});Object(n.useEffect)((()=>{const t=()=>{e({eventType:p.a.TAB_CLOSE,eventId:Object(f.b)(),details:{}})};return window.addEventListener("beforeunload",t),()=>{window.removeEventListener("beforeunload",t)}}),[e])};var A=()=>(y(),N(),S()),L=r(356),k=r(223),P=r(235),D=r(1),U=r(323),V=r(367),w=r.n(V),G=r(327),M=r(352),x=r(324);const H=e=>!!e&&(e.filters?w()(e.filters,(e=>H(e))):e.field===x.a.NUM_SNOOZE_ALLOWED);var F=r(310);const $=(new k.a).setUrl("/livechat/prompt/candidatePrompts").setType(P.a.POST).build(),B="ADD",Q="REMOVE",W="RESET",Z=e=>_()(e,(e=>{const t=e.snoozeConfig?(e=>{const t=G.a.getFilter(e),r=G.a.getSnoozeConfig(e);if(o()(r)||H(e.filter))return e;const n={filterType:M.a.LTE,field:x.a.NUM_SNOOZE_ALLOWED,values:[r.maxSnoozeCount],details:{numSnoozes:r.maxSnoozeCount-r.currentSnoozeCount,nextSnoozeDuration:r.nextSnoozeDuration}};return t?{...e,filter:{filterType:M.a.AND,filters:[n,t]}}:{...e,filter:n}})(e):e;return{...t,filter:Object(U.a)(t.filter,t.id)}}));var Y=()=>{const{data:e,refetch:t,fetchMore:r,updateQuery:c}=Object(j.a)({query:$,skipQueryOnMount:!0,mapFn:Z}),a=A().trackingStatus===C,[s,i]=Object(n.useState)(a?void 0:{isSilent:!1}),u=Object(L.a)(),o=Object(n.useRef)(a);o.current=a;const l=Object(n.useCallback)((e=>{if(!o.current)return i({isSilent:e}),null;return t({...Object(f.a)(),appId:Object(D.a)().appId},e?(e,t)=>b()(t,(e=>{const t=u.getActionState(e.interceptId,e.id);return t!==F.a.CLOSE&&t!==F.a.ENGAGE&&t!==F.a.SNOOZE})):void 0)}),[t]),d=Object(n.useCallback)((e=>o.current?r({...Object(f.a)(),appId:Object(D.a)().appId,...e},((e,t)=>O()([...e,...t],"id"))):(i({isSilent:!1}),null)),[]);Object(n.useEffect)((()=>{a&&s&&(l(s.isSilent),i(void 0))}),[a,s]);return[e,Object(n.useCallback)((e=>{switch(e.type){case B:return d(e.payload);case Q:{const t=new Set(T()(e.payload.interceptIds));return c((e=>b()(e,(e=>!t.has(G.a.getId(e)))))),null}case W:return l(e.payload.silent);default:return null}}),[c])]},z=r(726),K=r(782),X=r(271),J=r(257);const q=e=>`PROMPT_${X.a.getId(e)}_${Date.now()}_${Math.random().toString(16).substr(2,8)}`;let ee;const te=()=>ee,re=()=>{te().disconnect().then((()=>{Object(J.a)("MQTT Client | Disconnected")})).catch((e=>{console.error("MQTT Client | Disconnection Error",e)}))};var ne=r(199),ce=r(365);const ae="ADD_INTERCEPT",se="REMOVE_INTERCEPT";var ie=(e,t)=>{const r=Object(n.useMemo)((()=>({chatUser:ce.a.getChatUser(t),userName:ce.a.getChatSessionToken(t),inboxServerUrl:ce.a.getProactiveInboxServerUrl(t),userInbox:ce.a.getProactiveUserInbox(t)})),[t.chatUser,t.chatSessionToken,t.proactivePromptInboxServerUrl,t.proactiveUserInbox]);Object(n.useEffect)((()=>{(e=>{let{chatUser:t,userName:r,inboxServerUrl:n,userInbox:c}=e;const a=q(t);ee=new K.a({userName:r,clientId:a,inboxServerUrl:n,userInbox:c})})(r);try{(()=>{te().connect().catch((e=>{console.error("MQTT Client | Connection Error",e)}));const e=te();e.on("error",(()=>{Object(J.a)("MQTT Client | Error")})),e.on("offline",(()=>{Object(J.a)("MQTT Client | Offline")})),e.on("reconnect",(()=>{Object(J.a)("MQTT Client | Reconnect")})),e.on("close",(()=>{Object(J.a)("MQTT Client | Closed")}))})(),te().subscribe().catch((e=>{console.error("MQTT client | Subscribe Error",e)})),te().on("message",((t,r)=>{try{const t=JSON.parse(r.toString());e(t)}catch(n){Object(ne.b)(n)}}))}catch(t){Object(ne.b)(t),re()}return()=>{try{te().unsubscribe()}catch(e){Object(ne.b)(e)}finally{re()}}}),[r,e])},ue=r(216),oe=r.n(ue),le=r(682);const be=c.a.createContext({debug:oe.a,info:oe.a,warning:oe.a,error:oe.a}),de=e=>{let{children:t}=e;const r=Object(z.a)().chatUser,n=X.a.getId(r),c=Object(le.a)({category:"PROACTIVE_PROMPT",userId:n,batch:!0});return Object(i.jsx)(be.Provider,{value:c},t)},Oe=()=>Object(n.useContext)(be);var Ee=r(239);var Te=()=>{const{subscribe:e}=Object(g.a)(),t=Object(z.a)(),[r,c]=Y(),a=Oe(),s=Object(D.b)();Object(n.useEffect)((()=>{c({type:W,payload:{}})}),[c,t]);const i=Object(n.useCallback)((e=>{switch(e.payload.type){case ae:c({type:B,payload:{variables:e.payload.variables}});break;case se:c({type:Q,payload:{interceptIds:e.payload.interceptIds}})}}),[c]);return ie(i,t),Object(n.useEffect)((()=>{const t=e("fetchCandidatePromptBaseOnUrlChange",(()=>{c({type:W,payload:{silent:!0}})}));return()=>{t&&t()}}),[c]),Object(n.useEffect)((()=>{const e=e=>{if(e.response&&e.response.data&&e.response.data.eventType===Ee.a.USER_PROFILE_UPDATED.id)return c({type:W,payload:{silent:!0}})};return s.sprChat("subscribeToUpdate",{topic:"eventTriggered",subscriber:e}),()=>{s.sprChat("unsubscribeToUpdate",{topic:"eventTriggered",subscriber:e})}}),[c]),Object(n.useEffect)((()=>{const e=b()(r,(e=>!G.a.getCreativeId(e)));o()(e)||a.debug(`Available intercepts : ${JSON.stringify(e)}`)}),[r]),[r,c]},ve=r(946),_e=r.n(ve),je=r(15),Ie=r.n(je),he=r(334),ge=r.n(he);const fe=new Set([x.a.IS_CONVERSATION_OPEN]),pe="EXCLUDE_LIVE_CHAT_FILTERS",Ce="INCLUDE_LIVE_CHAT_FILTERS",me=(e,t)=>{if(!o()(e)){if(e.filterType===M.a.AND||e.filterType===M.a.OR){if(o()(e.filters))return;const r=ge()(_()(e.filters,(e=>me(e,t))));return o()(r)?void 0:{...e,filters:r}}return t===Ce&&fe.has(e.field)||t===pe&&!fe.has(e.field)?e:void 0}};var Se=r(857),Re=r(230);var ye=()=>{const{subscribe:e,getValue:t}=Object(g.a)();return{subscribe:Object(n.useCallback)(((t,r)=>{const n=Re.a.getId(t);return e(n,r)}),[e]),getValue:t}},Ne=r(1087),Ae=r(222),Le=r.n(Ae),ke=r(228),Pe=r.n(ke),De=r(8),Ue=r.n(De),Ve=r(49),we=r.n(Ve);var Ge=class{constructor(){this._startTime=void 0,this._endTime=void 0,this.start=()=>(this._startTime=this.getCurrentTime(),this._startTime),this.stop=()=>(this._endTime=this.getCurrentTime(),this._endTime),this.getCurrentTime=()=>Date.now(),this.getStartTime=()=>this._startTime,this.getEndTime=()=>this._endTime,this._startTime=0,this._endTime=0}};var Me=class{constructor(){this._clockInstance=void 0,this._activeTime=void 0,this._visibilityChangeHandler=()=>{const e=Object(R.d)();e||(this._clockInstance.stop(),this._activeTime+=this._clockInstance.getEndTime()-this._clockInstance.getStartTime()),e&&this._clockInstance.start()},this.time=()=>Object(R.d)()?this._activeTime+(this._clockInstance.getCurrentTime()-this._clockInstance.getStartTime()):this._activeTime,this._clockInstance=new Ge,Object(R.d)()&&this._clockInstance.start(),this._activeTime=0,document.addEventListener("visibilitychange",this._visibilityChangeHandler)}};var xe=()=>Object(n.useCallback)((e=>{let{startTime:t,expectedTime:r,onTimeout:n}=e;const c=r-(t||Date.now());let a;return c>0&&(a=window.setTimeout((()=>{n()}),c)),a}),[]);var He=()=>{const e=xe(),t=Object(n.useRef)();t.current=Object(n.useMemo)((()=>new Me),[]);const r=Object(n.useRef)({}),c=Object(n.useCallback)((()=>{const n=Object(R.d)();n&&we()(r.current,((n,c)=>{const{onChangeCallback:a}=n,s=e({startTime:t.current.time(),expectedTime:Pe()(Re.a.getValues(Ue()(n,"filter"))),onTimeout:a});s&&(r.current={...r.current,[c]:{...r.current[c],timeoutId:s}})})),n||we()(r.current,(e=>{const{timeoutId:t}=e;t&&window.clearTimeout(t)}))}),[]);Object(n.useEffect)((()=>(document.addEventListener("visibilitychange",c),()=>{document.removeEventListener("visibilitychange",c)})),[]);return{subscribe:Object(n.useCallback)(((n,c)=>{const a=Re.a.getId(n),s=Object(R.d)();if(s){const s=e({startTime:t.current.time(),expectedTime:Pe()(Re.a.getValues(n)),onTimeout:c});s&&(r.current={...r.current,[a]:{timeoutId:s,filter:n,onChangeCallback:c}})}return s||(r.current={...r.current,[a]:{filter:n,onChangeCallback:c}}),()=>{clearTimeout(Ue()(r.current,`${a}.timeoutId`)),r.current=Le()(r.current,a)}}),[]),getValue:Object(n.useCallback)((()=>t.current.time()),[])}};var Fe=class{constructor(){this._clockInstance=void 0,this._inactiveTime=void 0,this._visibilityChangeHandler=()=>{const e=Object(R.d)();e||this._clockInstance.start(),e&&(this._clockInstance.stop(),this._inactiveTime+=this._clockInstance.getEndTime()-this._clockInstance.getStartTime())},this.time=()=>Object(R.d)()?this._inactiveTime:this._inactiveTime+(this._clockInstance.getCurrentTime()-this._clockInstance.getStartTime()),this._clockInstance=new Ge,Object(R.d)()||this._clockInstance.start(),this._inactiveTime=0,document.addEventListener("visibilitychange",this._visibilityChangeHandler)}};var $e=()=>{const e=xe(),t=Object(n.useRef)();t.current=Object(n.useMemo)((()=>new Fe),[]);const r=Object(n.useRef)({}),c=Object(n.useCallback)((()=>{const n=Object(R.d)();n&&we()(r.current,(e=>{const{timeoutId:t}=e;t&&window.clearTimeout(t)})),n||we()(r.current,((n,c)=>{const{onChangeCallback:a}=n,s=e({startTime:t.current.time(),expectedTime:Pe()(Re.a.getValues(Ue()(n,"filter"))),onTimeout:a});s&&(r.current={...r.current,[c]:{...r.current[c],timeoutId:s}})}))}),[]);Object(n.useEffect)((()=>(document.addEventListener("visibilitychange",c),()=>{document.removeEventListener("visibilitychange",c)})),[]);return{subscribe:Object(n.useCallback)(((n,c)=>{const a=Re.a.getId(n),s=Object(R.d)();if(!s){const s=e({startTime:t.current.time(),expectedTime:Pe()(Re.a.getValues(n)),onTimeout:c});s&&(r.current={...r.current,[a]:{timeoutId:s,filter:n,onChangeCallback:c}})}return s&&(r.current={...r.current,[a]:{filter:n,onChangeCallback:c}}),()=>{clearTimeout(Ue()(r.current,`${a}.timeoutId`)),r.current=Le()(r.current,a)}}),[]),getValue:Object(n.useCallback)((()=>t.current.time()),[])}};const Be=(e,t)=>Ie()(e,((e,r,n)=>{const c=r.variants.filter((e=>e.actionState===t));return o()(c)||(r.variants=c,e[n]=r),e}),{});var Qe=()=>{const e=Object(n.useRef)({}),t=Object(L.a)();return{subscribe:Object(n.useCallback)(((r,n)=>{const c=Re.a.getId(r),a=Pe()(Re.a.getValues(r));if(!t.getActionState(a)){const r=t.setSubscriber(a,(e=>{e===F.a.ENGAGE&&n()}));e.current={...e.current,[c]:{unsubscribeInterceptActionEvent:r}}}return()=>{const t=Ue()(e.current,`${c}.unsubscribeInterceptActionEvent`);t&&t(),e.current=Le()(e.current,c)}}),[]),getValue:Object(n.useCallback)((()=>Be(t.getActionDetails(),F.a.ENGAGE)),[])}};var We=()=>{const e=Object(n.useRef)({}),t=Object(L.a)();return{subscribe:Object(n.useCallback)(((r,n)=>{const c=Re.a.getId(r),a=Pe()(Re.a.getValues(r));if(!t.getActionState(a)){const r=t.setSubscriber(a,(e=>{e===F.a.CLOSE&&n()}));e.current={...e.current,[c]:{unsubscribeInterceptActionEvent:r}}}return()=>{const t=Ue()(e.current,`${c}.unsubscribeInterceptActionEvent`);t&&t(),e.current=Le()(e.current,c)}}),[]),getValue:Object(n.useCallback)((()=>Be(t.getActionDetails(),F.a.CLOSE)),[])}};var Ze=()=>{const{getValue:e,subscribe:t}=Qe(),{getValue:r,subscribe:c}=We(),a=Object(n.useRef)({});return{subscribe:Object(n.useCallback)(((t,n,c)=>{const s=Re.a.getId(t);switch(c&&Re.a.getField(c)){case x.a.INTERCEPT_CLOSED_IN_SESSION_KEY:{const e=r(),i=Pe()(Re.a.getValues(c)),u=()=>{const r=Pe()(Re.a.getValues(t)),c=e[i]?e[i].variants:[],u=c[c.length-1].actionTime,o=r-(Date.now()-u);let l;o>0&&(l=window.setTimeout((()=>{n()}),o),a.current={...a.current,[s]:[()=>clearTimeout(l)]})};e[i]&&u();break}case x.a.INTERCEPT_ENGAGED_IN_SESSION_KEY:{const r=e(),i=Pe()(Re.a.getValues(c)),u=()=>{const e=Pe()(Re.a.getValues(t)),c=r[i]?r[i].variants:[],u=c[c.length-1].actionTime,o=e-(Date.now()-u);let l;o>0&&(l=window.setTimeout((()=>{n()}),o),a.current={...a.current,[s]:[()=>clearTimeout(l)]})};r[i]&&u();break}}return()=>{_()(a.current[s],(e=>e())),a.current=Le()(a.current,s)}}),[])}},Ye=r(859),ze=r(861);var Ke=class{constructor(){this._clockInstance=void 0,this._totalTime=void 0,this.time=()=>(this._totalTime=this._clockInstance.getCurrentTime()-this._clockInstance.getStartTime(),this._totalTime),this._clockInstance=new Ge,this._totalTime=0,this._clockInstance.start()}};var Xe=r(270),Je=r.n(Xe);var qe=()=>{const e=Object(n.useRef)({});return{subscribe:Object(n.useCallback)(((t,r)=>{const n=Re.a.getId(t),{start:c,end:a}=Ue()(t,"details.range[0]");let s,i;const u=c,o=Je()(a)?-1:a;return u>0&&(s=window.setTimeout(r,u)),o>0&&(i=window.setTimeout(r,o)),e.current={...e.current,[n]:{...e.current[n],timeoutIdToGetInRange:s,timeoutIdToGetOutFromRange:i,timerStartTime:Date.now()}},()=>{clearTimeout(Ue()(e.current,`${n}.timeoutIdToGetInRange`)),clearTimeout(Ue()(e.current,`${n}.timeoutIdToGetOutFromRange`)),e.current=Le()(e.current,n)}}),[]),getValue:Object(n.useCallback)((()=>t=>{const r=Re.a.getId(t),{start:n,end:c}=Ue()(t,"details.range[0]"),a=Ue()(e.current,`${r}.timerStartTime`),s=Date.now()-a;return Je()(n)||Je()(c)?Je()(n)||s>=n?0:1:s>=c?1:s>=n?0:1}),[])}};var et=()=>{const{getValue:e,subscribe:t}=ye(),{getValue:r,subscribe:c}=Object(Ne.a)(),{getValue:a,subscribe:s}=He(),{getValue:i,subscribe:u}=$e(),{getValue:o,subscribe:l}=We(),{getValue:b,subscribe:d}=Qe(),{subscribe:O}=Ze(),{getValue:E,subscribe:T}=Object(Ye.a)(),{getValue:v,subscribe:_}=Object(ze.a)(),{getValue:j,subscribe:I}=(()=>{const e=Object(n.useRef)({});return{subscribe:Object(n.useCallback)(((t,r)=>{const n=Re.a.getId(t),c=Pe()(Re.a.getValues(t));let a;return c>0&&(a=window.setTimeout((()=>{e.current={...e.current,[n]:{...e.current.id,timeLeft:0}},r()}),c)),e.current={...e.current,[n]:{timeoutId:a,timeLeft:c}},()=>{window.clearTimeout(Ue()(e.current,`${n}.timeoutId`)),e.current=Le()(e.current,n)}}),[]),getValue:Object(n.useCallback)((()=>t=>{const r=Re.a.getId(t);return Ue()(e.current,`${r}.timeLeft`,0)}),[])}})(),{getValue:h,subscribe:g}=(()=>{const e=xe(),t=Object(n.useRef)(new Ke),r=Object(n.useRef)({});return{subscribe:Object(n.useCallback)(((n,c)=>{const a=Re.a.getId(n),s=Ue()(Re.a.getDetails(n),"nextSnoozeDuration",0),i=t.current.time(),u=e({startTime:i,expectedTime:i+s,onTimeout:()=>{r.current={...r.current,[a]:{...r.current.id,timeLeft:0}},c()}});return u&&(r.current={...r.current,[a]:{timeoutId:u,timeLeft:s}}),()=>{clearTimeout(Ue()(r.current,`${a}.timeoutId`)),r.current=Le()(r.current,a)}}),[]),getValue:Object(n.useCallback)((()=>e=>{const t=Re.a.getId(e);return Ue()(r.current,`${t}.timeLeft`,0)}),[])}})(),{getValue:f,subscribe:p}=qe();return{getValue:Object(n.useCallback)((()=>({[x.a.CURRENT_URL]:e(),[x.a.TOTAL_TIME_SPENT]:r(),[x.a.ACTIVE_TIME_SPENT]:a(),[x.a.INACTIVE_TIME_SPENT]:i(),[x.a.INTERCEPT_ENGAGED_IN_SESSION_KEY]:b(),[x.a.INTERCEPT_CLOSED_IN_SESSION_KEY]:o(),[x.a.VERTICAL_PAGE_SCROLL_DEPTH]:E(),[x.a.HORIZONTAL_PAGE_SCROLL_DEPTH]:v(),[x.a.TIME_SPENT_ON_SESSION]:j(),[x.a.NUM_SNOOZE_ALLOWED]:h(),[x.a.BUSINESS_HOURS]:f()})),[e,r,a,i,o,b,E,v,j,h,f]),subscribe:Object(n.useCallback)(((e,r,n)=>{switch(Re.a.getField(e)){case x.a.TOTAL_TIME_SPENT:return c(e,r);case x.a.CURRENT_URL:return t(e,r);case x.a.ACTIVE_TIME_SPENT:return s(e,r);case x.a.INACTIVE_TIME_SPENT:return u(e,r);case x.a.INTERCEPT_CLOSED_IN_SESSION_KEY:return l(e,r);case x.a.INTERCEPT_ENGAGED_IN_SESSION_KEY:return d(e,r);case x.a.DEPENDENT_DURATION_KEY:return O(e,r,n);case x.a.VERTICAL_PAGE_SCROLL_DEPTH:return T(e,r);case x.a.HORIZONTAL_PAGE_SCROLL_DEPTH:return _(e,r);case x.a.TIME_SPENT_ON_SESSION:return I(e,r);case x.a.NUM_SNOOZE_ALLOWED:return g(e,r);case x.a.BUSINESS_HOURS:return p(e,r);default:return oe.a}}),[t,c,s,u,l,d,O,T,_,I,g,p])}},tt=r(227);var rt=(e,t)=>{const{getValue:r,subscribe:c}=et(),a=Object(n.useCallback)((()=>{var e,n;return{...null!==(e=null===t||void 0===t||null===(n=t._getStaticValueMap)||void 0===n?void 0:n.call(t))&&void 0!==e?e:tt.a,...r()}}),[r,null===t||void 0===t?void 0:t._getStaticValueMap]);return Object(Se.a)(e,{...t,getValue:a,subscribe:c})},nt=r(279),ct=r.n(nt);var at=e=>{const[t,r]=Object(n.useState)(0),c=Object(n.useRef)([]),a=Object(n.useRef)({}),s=Object(D.b)();return Object(n.useMemo)((()=>{o()(e)?c.current=[{hasPassed:!0}]:c.current=_()(e,(e=>{let{id:t,filter:r}=e;const n=o()(r)||a.current[t];return delete a.current[t],{hasPassed:n}}))}),[e]),Object(n.useEffect)((()=>{if(!o()(ge()(_()(e,"filter")))){const t=ct.a.v4(),n=t=>{let{data:n}=t;n&&(c.current=_()(e,((e,t)=>{var r,c;let{id:s,filter:i}=e;return a.current[s]=!i||(null===(r=n.results)||void 0===r||null===(c=r[t])||void 0===c?void 0:c.passed),{hasPassed:a.current[s]}})),r((e=>e+1)))};return s.sprChat("addFilterToEvaluate",{id:t,filters:_()(e,"filter")},n),()=>{s.sprChat("removeFilterToEvaluate",{id:t})}}}),[e]),c.current};var st=e=>{const t=Object(n.useRef)([]),r=Oe(),{interceptsWithoutLiveChatFilterToEvaluate:c,interceptsOnlyWithLiveChatFilterToEvaluate:a}=Object(n.useMemo)((()=>Ie()(e,((e,t)=>{const r=me(G.a.getFilter(t),pe),n=me(G.a.getFilter(t),Ce);return{interceptsWithoutLiveChatFilterToEvaluate:[...e.interceptsWithoutLiveChatFilterToEvaluate,r],interceptsOnlyWithLiveChatFilterToEvaluate:[...e.interceptsOnlyWithLiveChatFilterToEvaluate,{id:G.a.getId(t),filter:n}]}}),{interceptsWithoutLiveChatFilterToEvaluate:[],interceptsOnlyWithLiveChatFilterToEvaluate:[]})),[e]),s=rt(c,{defaultValue:!0}),i=at(a);return Object(n.useMemo)((()=>{t.current=[],_()(e,((e,r)=>{s[r].hasPassed&&i[r].hasPassed&&(t.current=[...t.current,e])}))}),[s,i,e]),Object(n.useEffect)((()=>{const e=b()(t.current,(e=>!G.a.getCreativeId(e)));o()(e)||r.debug(`filterPassedIntercepts : ${JSON.stringify(e)}`)}),[t.current]),t.current},it=r(372);const ut=(e,t)=>t?Ie()(G.a.getTargets(e),((e,r,n)=>({...e,[n]:{...r,additional:t[r.value]}})),{}):G.a.getTargets(e);var ot=r(262);const lt="/livechat/prompt";async function bt(e){return(await ot.a.post(`${lt}/creative/${e}`)).data}async function dt(e){return(await ot.a.post(`${lt}/fetch/survey`,e)).data}const Ot=["snoozeConfig"];var Et=e=>{const[t,r]=Object(n.useState)(0),c=Object(n.useRef)([]),a=Object(n.useRef)({}),s=Oe();return Object(n.useMemo)((()=>{c.current=[],_()(e,(e=>{if(!e)return;if(!G.a.getCreativeId(e))return void s.debug(`Intercept resolver : ${JSON.stringify(e)}`);if(!o()(a.current[G.a.getId(e)]))return void c.current.push({...e,...Le()(a.current[G.a.getId(e)],Ot)});const t=(e=>{const t=G.a.getId(e),r=Ie()(G.a.getTargets(e),((e,t)=>t.type===it.a.SURVEY||t.type===it.a.SURVEY_INLINE?{...e,surveyURLs:e.surveyURLs?[...e.surveyURLs,t.value]:[t.value]}:e),{});return o()(r)?void 0:{...r,variantId:t}})(e);Promise.all([bt(G.a.getCreativeId(e)),t?dt(t):Promise.resolve(void 0)]).then((t=>{let[n,s]=t;const i={...e,creative:n,targets:ut(e,s)};a.current[G.a.getId(e)]=i,c.current=[...c.current,i],r((e=>e+1))})).catch((e=>{Object(ne.b)(e)}))}))}),[e,r]),c.current};var Tt=e=>{const t=Object(n.useRef)([]),r=st(e),c=Et(r);return Object(n.useMemo)((()=>{t.current=O()([..._e()(t.current,c,"id"),...c],"id")}),[c]),t.current},vt=r(497);const _t=new Set([it.a.LIVE_CHAT_EXECUTE_RULE,it.a.LIVE_CHAT_ROUTE_TO_BOT,it.a.LIVE_CHAT_WITH_AGENT,it.a.CHAT_WITH_AGENT,it.a.ROUTE_TO_BOT,it.a.EXECUTE_RULE]);var jt=e=>{const[t,r]=Object(n.useState)([]),c=Object(D.b)();return Object(n.useEffect)((()=>{const t=t=>{const n=t?e:(e=>Ie()(e,((e,t)=>{let r=!1;return we()(G.a.getTargets(t),(e=>{if(_t.has(vt.a.getType(e)))return r=!0,!1})),r?e:[...e,t]}),[]))(e);r((e=>O()([..._e()(e,n,"id"),...n],"id")))};return c.sprChat("onAvailabilityChange",t),()=>{c.sprChat("offAvailabilityChange",t)}}),[r,e,c]),t};const It="REMOVE_INTERCEPT";var ht=function(){const[e,t]=Te(),r=Tt(e);return[jt(r),Object(n.useCallback)((e=>{e.type===It&&t({type:Q,payload:{interceptIds:[e.payload.interceptId]}})}),[])]},gt=r(200),ft=r(727),pt=r(210);const Ct="POPUP",mt="LIVECHAT",St="POSITIONED_POPUP",Rt=Object(pt.a)((()=>r.e(52).then(r.bind(null,1552)))),yt=Object(pt.a)((()=>r.e(53).then(r.bind(null,1542)))),Nt=Object(pt.a)((()=>r.e(45).then(r.bind(null,1553)))),At=new Set([Ct,mt,St]),Lt=e=>{const{intercepts:t}=e,r=Object(n.useMemo)((()=>Ie()(t,((e,t)=>{const r=ft.a.getType(G.a.getCreative(t));return At.has(r)&&e[r].push(t),e}),{[Ct]:[],[mt]:[],[St]:[]})),[t]),a=r[Ct],s=r[St],u=r[mt];return Object(i.jsx)(c.a.Fragment,null,o()(s)?null:Object(i.jsx)(n.Suspense,{fallback:null},Object(i.jsx)(yt,Object(gt.a)({},e,{intercepts:s}))),o()(a)?null:Object(i.jsx)(n.Suspense,{fallback:null},Object(i.jsx)(Rt,Object(gt.a)({},e,{intercepts:a}))),o()(u)?null:Object(i.jsx)(n.Suspense,{fallback:null},Object(i.jsx)(Nt,Object(gt.a)({},e,{intercepts:u}))))};var kt=c.a.memo(Lt);var Pt=()=>{const[e,t]=ht(),r=Object(n.useCallback)((e=>{t({type:It,payload:{interceptId:e}})}),[t]);return o()(e)?null:Object(i.jsx)(kt,{intercepts:e,onClose:r})},Dt=r(728),Ut=r(884);var Vt=function(e){const t=Object(Ut.a)(e.window);return Object(i.jsx)(Dt.a.Provider,{value:t},e.children)},wt=r(945),Gt=r(1085),Mt=r(691),xt=r(686),Ht=r(486);const Ft=e=>{const t=Object(D.b)(),r=Object(n.useMemo)((()=>Object(Ht.a)(t.document)),[t.document]);return Object(i.jsx)(i.CacheProvider,{value:r},Object(i.jsx)(Vt,{window:t},Object(i.jsx)(wt.a.Provider,{value:e.handshakeDetails},Object(i.jsx)(Gt.b,null,Object(i.jsx)(de,null,Object(i.jsx)(Mt.b,null,Object(i.jsx)(xt.a,null,Object(i.jsx)(Pt,null))))))))};var $t=c.a.memo(Ft),Bt=r(855);function Qt(e,t){const r=Object(Bt.a)();s.a.render(Object(i.jsx)($t,{handshakeDetails:t}),r)}},255:function(e,t,r){"use strict";var n=r(191),c=r(319),a=r.n(c);const s="DATA_LOADING",i="DATA_LOADED",u="DATA_UPDATED",o="DATA_LOAD_FAILED",l="DATA_FETCHING_MORE",b={loading:!1,error:void 0,data:void 0},d=(e,t)=>{switch(t.type){case s:return{...e,loading:!0,data:void 0,error:void 0};case l:return{...e,loading:!0,error:void 0};case i:return{...e,loading:!1,data:t.payload};case o:return{...e,loading:!1,error:t.payload};case u:return{...e,data:t.payload};default:return e}};var O=()=>Object(n.useReducer)(d,b),E=r(223),T=r(262);const v=(e,t)=>t!==e.current;t.a=e=>{let{query:t,skipQueryOnMount:r,payload:c,onCompleted:b,mapFn:d,options:_}=e;const[j,I]=O(),{loading:h,data:g,error:f}=j,p=Object(n.useRef)(null),C=Object(n.useRef)(g);C.current=g;const m=E.a.getType(t),S=E.a.getUrl(t),R=Object(n.useRef)(b);R.current=b;const y=Object(n.useCallback)((()=>{p.current=null}),[]),N=Object(n.useCallback)((async(e,t)=>{y(),p.current=t;const r=await T.a[m](S,e,_);if(!v(p,t))return R.current&&R.current(r.data),r}),[m,S]),A=Object(n.useCallback)((async e=>{I({type:s,payload:{}});const t=a()("reqId");try{const n=await N(e,t);var r;if(!v(p,t))I({type:i,payload:null!==(r=null===d||void 0===d?void 0:d(n.data))&&void 0!==r?r:null===n||void 0===n?void 0:n.data})}catch(n){v(p,t)||I({type:o,payload:n})}}),[N]);Object(n.useEffect)((()=>{r||A(c)}),[]);const L=Object(n.useCallback)((async(e,t)=>{I({type:l,payload:{}});const r=a()("reqId");try{const c=await N(e,r);if(!v(p,r)){var n;let e=c.data;t&&(e=t(C.current,c.data)),I({type:i,payload:null!==(n=null===d||void 0===d?void 0:d(e))&&void 0!==n?n:e})}}catch(c){v(p,r)||I({type:o,payload:c})}}),[N]),k=Object(n.useCallback)((async(e,t)=>{t?await L(e,t):await A(e)}),[A]),P=Object(n.useCallback)((e=>{var t;const r=e(C.current);I({type:u,payload:null!==(t=null===d||void 0===d?void 0:d(r))&&void 0!==t?t:r})}),[]);return{loading:h,data:g,error:f,refetch:k,fetchMore:L,updateQuery:P}}},298:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));const n={PAGE_VISIT:"PAGE_VISIT",TAB_CHANGE:"TAB_CHANGE",TAB_CLOSE:"TAB_CLOSE",INTERCEPT_SNOOZE_TRIGGERED:"INTERCEPT_SNOOZE_TRIGGERED",INTERCEPT_TRIGGERED:"INTERCEPT_TRIGGERED",INTERCEPT_CLOSED:"INTERCEPT_CLOSED",INTERCEPT_ENGAGED:"INTERCEPT_ENGAGED",SNOOZE:"SNOOZE",INTERCEPT_TRIGGERED_IN_BACKGROUND:"INTERCEPT_TRIGGERED_IN_BACKGROUND",INTERCEPT_AUTO_CLOSED:"INTERCEPT_AUTO_CLOSED"}},310:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));const n={CLOSE:"CLOSE",ENGAGE:"ENGAGE",TRIGGERED:"TRIGGERED",SNOOZE:"SNOOZE"}},327:function(e,t,r){"use strict";r.d(t,"a",(function(){return E}));var n=r(1560),c=r(1554),a=r(1452);const s=Object(n.a)("id"),i=Object(n.a)("creativeId"),u=Object(n.a)("targets"),o=Object(c.a)(["creative","socialAsset","content"]),l=Object(n.a)("settings"),b=Object(n.a)("filter"),d=Object(n.a)("snoozeConfig"),O=Object(c.a)(["additional","surveyResponseId"]);class E{}E.getId=Object(a.a)(s),E.getCreativeId=Object(a.a)(i),E.getTargets=Object(a.a)(u),E.getCreative=Object(a.a)(o),E.getFilter=Object(a.a)(b),E.getSettings=Object(a.a)(l),E.getSnoozeConfig=Object(a.a)(d),E.getSurveyResponseId=Object(a.a)(O)},356:function(e,t,r){"use strict";var n=r(191),c=r(1085);t.a=()=>Object(n.useContext)(c.a)},372:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));const n={LIVE_CHAT_ROUTE_TO_BOT:"LIVE_CHAT_ROUTE_TO_BOT",LIVE_CHAT_EXECUTE_RULE:"LIVE_CHAT_EXECUTE_RULE",LIVE_CHAT_WITH_AGENT:"LIVE_CHAT_WITH_AGENT",CLOSE:"CLOSE",SURVEY:"SURVEY",SURVEY_INLINE:"SURVEY_INLINE",CHAT_WITH_AGENT:"CHAT_WITH_AGENT",ROUTE_TO_BOT:"ROUTE_TO_BOT",EXECUTE_RULE:"EXECUTE_RULE",REMOVE:"REMOVE",SNOOZE:"SNOOZE",URL:"OPEN_URL"}},389:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(191),c=r(9);const a=()=>{const[e,t]=Object(n.useState)(Object(c.d)());return Object(n.useEffect)((()=>{const e=()=>{const e=Object(c.d)();e||t(!1),e&&t(!0)};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}}),[]),e}},496:function(e,t,r){"use strict";var n=r(191),c=r(31),a=r.n(c),s=r(364),i=r.n(s),u=r(286),o=r.n(u),l=r(255),b=r(389),d=r(726),O=r(223),E=r(50),T=r(235),v=r(298);const _=(new O.a).setUrl("/livechat/prompt/browse/event").setType(T.a.POST).build(),j=(()=>{const e={};return{set:(t,r)=>{e[r]=t},get:t=>e[t],push:(t,r)=>{var n;e[r]=[...null!==(n=e[r])&&void 0!==n?n:[],...o()(t)]}}})(),I=e=>({...e,sourceType:"PROACTIVE_PROMPT",page:Object(E.a)().pageUrl,timeZone:Object(E.a)().timeZone,userAgent:Object(E.a)().userAgent});t.a=function(){let{skipQueryOnMount:e,payload:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{skipQueryOnMount:!1};const{refetch:r,...c}=Object(l.a)({query:_,skipQueryOnMount:e,payload:t?I(t):void 0}),s=Object(d.a)(),u=s.chatUser.userId,o=Object(b.a)(),O=Object(n.useRef)(o);O.current=o;const E=Object(n.useCallback)((e=>{const t=I(e);if(O.current)r(t);else if(t.eventType===v.a.INTERCEPT_AUTO_CLOSED){const e=i()(j.get(u),(e=>e.eventId===t.eventId&&e.eventType===v.a.INTERCEPT_TRIGGERED));-1!==e&&j.get(u).splice(e,1),j.push(t,u)}else t.eventType===v.a.INTERCEPT_TRIGGERED&&r({...t,eventType:v.a.INTERCEPT_TRIGGERED_IN_BACKGROUND}),j.push(t,u)}),[r,u]);return Object(n.useEffect)((()=>{o&&!a()(j.get(u))&&window.setTimeout((()=>{a()(j.get(u))||(r(j.get(u)),j.set([],u))}),0)}),[o]),{...c,refetch:E}}},497:function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var n=r(1560),c=r(1452);const a=Object(n.a)("type"),s=Object(n.a)("value"),i=Object(n.a)("additional");class u{}u.getType=Object(c.a)(a),u.getValue=Object(c.a)(s),u.getAdditional=Object(c.a)(i)},726:function(e,t,r){"use strict";var n=r(191),c=r(945);t.a=()=>Object(n.useContext)(c.a)},727:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r(1560),c=r(1452);const a=Object(n.a)("type");class s{}s.getType=Object(c.a)(a)},728:function(e,t,r){"use strict";var n=r(191);const c=r.n(n).a.createContext({height:0,width:0});t.a=c},945:function(e,t,r){"use strict";var n=r(191);const c=r.n(n).a.createContext(void 0);t.a=c},946:function(e,t,r){var n=r(56),c=r(1399),a=r(53),s=r(86),i=r(1400),u=r(247),o=s((function(e){var t=u(e),r=n(e,i);return t===u(r)?t=void 0:r.pop(),r.length&&r[0]===e[0]?c(r,a(t,2)):[]}));e.exports=o}}]);